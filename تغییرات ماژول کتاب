# قابلیت‌های افزوده شده به فعالیت کتاب (Book) در Moodle

این پلاگین کوچک (`local_booktree`) قابلیت‌های زیر را به ماژول کتاب (Book) اضافه می‌کند:

---

## 1. سلسله‌مراتب بی‌نهایت برای فصل‌ها

- پیش‌فرض ماژول کتاب فقط امکان 2 سطح (فصل و زیرفصل) را دارد.  
- با این پلاگین می‌توان هر تعداد زیرسطح برای فصل‌ها ایجاد کرد.  
- هنگام ایجاد فصل یا زیرفصل، اگر گزینه **"ساب‌کپچر (درختی)"** فعال باشد:
  - این فصل به عنوان زیرمجموعه فصل فعلی ذخیره می‌شود.
  - هر زیرفصل می‌تواند خودش زیرمجموعه داشته باشد (ساختار درختی بی‌نهایت).

---

## 2. ذخیره‌سازی سلسله‌مراتب در دیتابیس

- یک جدول اختصاصی (`local_booktree_ch`) اضافه شده که شامل ستون‌های زیر است:
  - `chapterid` → شناسه فصل اصلی از جدول `book_chapters`
  - `parentchapterid` → شناسه والد (null اگر ریشه باشد)
  - `level` → سطح فصل در درخت
  - `timecreated` و `timemodified`
- این روش تضمین می‌کند که سلسله‌مراتب به درستی حفظ شود و با آپدیت Moodle تداخل نداشته باشد.

---

## 3. نمایش درختی باز و بسته‌شونده

- یک صفحه جدید (`view.php`) اضافه شده که درخت کتاب را نمایش می‌دهد:
  - فصل‌ها و زیرفصل‌ها به صورت درختی نمایش داده می‌شوند.
  - هر شاخه قابل باز و بسته شدن است.
  - لینک مستقیم هر فصل برای مشاهده محتوا وجود دارد.

---

## 4. سازگاری با ماژول کتاب

- این پلاگین بدون تغییر در core یا ماژول کتاب (`mod/book`) کار می‌کند.
- JS و webservice اختصاصی (`local_booktree_save`) برای ثبت سلسله‌مراتب استفاده می‌شود.
- اطلاعات اصلی فصل‌ها همچنان در جدول `book_chapters` ذخیره می‌شوند.

---

## 5. نصب و استفاده

- نصب از طریق **local plugin** انجام می‌شود:
